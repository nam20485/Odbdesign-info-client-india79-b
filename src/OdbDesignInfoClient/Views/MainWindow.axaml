<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:OdbDesignInfoClient.Core.ViewModels"
        xmlns:views="using:OdbDesignInfoClient.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="OdbDesignInfoClient.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="{Binding Title}"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        WindowStartupLocation="CenterScreen">

    <DockPanel>
        <!-- Command Bar (Top) -->
        <Border DockPanel.Dock="Top" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" 
                Padding="8">
            <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto">
                <!-- Connection Indicator -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <Ellipse Width="12" Height="12" x:Name="ConnectionIndicator">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Setter Property="Fill" Value="Gray"/>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                    <TextBlock Text="Server" VerticalAlignment="Center" FontWeight="SemiBold"/>
                </StackPanel>

                <!-- Connection State Text -->
                <TextBlock Grid.Column="1" 
                           Text="{Binding ConnectionState}" 
                           VerticalAlignment="Center"
                           Margin="8,0"
                           Opacity="0.7"/>

                <!-- Design Selector -->
                <ComboBox Grid.Column="3" 
                          ItemsSource="{Binding Designs}"
                          SelectedItem="{Binding SelectedDesign}"
                          MinWidth="200"
                          Margin="8,0"
                          PlaceholderText="Select a design..."
                          IsEnabled="{Binding IsConnected}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Refresh Button -->
                <Button Grid.Column="4" 
                        Command="{Binding RefreshCommand}" 
                        Margin="4,0" 
                        ToolTip.Tip="Refresh data">
                    <TextBlock Text="Refresh"/>
                </Button>

                <!-- Connect/Disconnect Button -->
                <Button Grid.Column="5" 
                        Command="{Binding ConnectCommand}"
                        Margin="4,0">
                    <TextBlock Text="Connect"/>
                </Button>
            </Grid>
        </Border>

        <!-- Reconnecting Overlay -->
        <Border DockPanel.Dock="Top"
                IsVisible="{Binding IsReconnecting}"
                Background="#FFFFC107"
                Padding="8,4">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="100" Height="4" Margin="0,0,8,0"/>
                <TextBlock Text="Reconnecting to server..." FontWeight="SemiBold"/>
            </StackPanel>
        </Border>

        <!-- Status Bar (Bottom) -->
        <Border DockPanel.Dock="Bottom" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" 
                Padding="8,4">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                <TextBlock Grid.Column="0" 
                           Text="{Binding StatusMessage}" 
                           VerticalAlignment="Center"/>
                
                <!-- Loading Indicator -->
                <ProgressBar Grid.Column="1"
                             IsVisible="{Binding IsLoading}"
                             IsIndeterminate="True"
                             Width="100"
                             Height="4"
                             Margin="8,0"/>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="16,0">
                    <TextBlock Text="Viewer:" VerticalAlignment="Center"/>
                    <Ellipse Width="8" Height="8" x:Name="ViewerIndicator">
                        <Ellipse.Styles>
                            <Style Selector="Ellipse">
                                <Setter Property="Fill" Value="Gray"/>
                            </Style>
                        </Ellipse.Styles>
                    </Ellipse>
                </StackPanel>
                
                <TextBlock Grid.Column="3" 
                           Text="v1.0.0" 
                           VerticalAlignment="Center" 
                           Opacity="0.6"/>
            </Grid>
        </Border>

        <!-- Main Content Area with Tabs -->
        <TabControl SelectedIndex="{Binding SelectedTabIndex}" Margin="8">
            <TabItem Header="Components">
                <views:ComponentsTabView DataContext="{Binding ComponentsTab}"/>
            </TabItem>
            <TabItem Header="Nets">
                <views:NetsTabView DataContext="{Binding NetsTab}"/>
            </TabItem>
            <TabItem Header="Stackup">
                <views:StackupTabView DataContext="{Binding StackupTab}"/>
            </TabItem>
            <TabItem Header="Drill Tools">
                <views:DrillToolsTabView DataContext="{Binding DrillToolsTab}"/>
            </TabItem>
            <TabItem Header="Packages">
                <views:PackagesTabView DataContext="{Binding PackagesTab}"/>
            </TabItem>
            <TabItem Header="Parts">
                <views:PartsTabView DataContext="{Binding PartsTab}"/>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
